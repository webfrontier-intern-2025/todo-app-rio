{% extends "base.html" %}
{% block title %}Todoä¸€è¦§{% endblock %}
{% block content %}
<h2>Todoä¸€è¦§</h2>

{% if error %}
  <div style="color: red; font-weight: bold; margin-bottom: 10px;">
    âš  {{ error }}
  </div>
{% endif %}

<!-- Todoè¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
<form action="/add" method="post">
  <input type="text" name="content" placeholder="ã‚¿ã‚¤ãƒˆãƒ«" required>
  <input type="date" name="deadline" placeholder="æœŸé™">

  <!-- âœ… ã‚¿ã‚°é¸æŠæ¬„ã‚’è¿½åŠ  -->
  <div style="margin: 10px 0;">
    <strong>ã‚¿ã‚°ã‚’é¸æŠ:</strong><br>
    {% if tags %}
      {% for tag in tags %}
        <label style="margin-right: 10px;">
          <input type="checkbox" name="tag_ids" value="{{ tag.id }}">
          {{ tag.name }}
        </label>
      {% endfor %}
    {% else %}
      <p>ã‚¿ã‚°ãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<a href="/tags">ã‚¿ã‚°ç®¡ç†ç”»é¢ã¸</a></p>
    {% endif %}
  </div>

  <button type="submit">è¿½åŠ </button>
</form>

<hr>

<h3>ç™»éŒ²æ¸ˆã¿Todo</h3>
<ul>
{% for t in todos %}
  <li {% if t.complete %}style="text-decoration: line-through; color: gray;"{% endif %}>
    
    <!-- âœ… å®Œäº†ãƒã‚§ãƒƒã‚¯ -->
    <form action="/toggle/{{ t.id }}" method="post" style="display:inline;">
      <input type="hidden" name="complete" value="{{ 'false' if t.complete else 'true' }}">
      <input type="checkbox" onChange="this.form.submit()" {% if t.complete %}checked{% endif %}>
    </form>

    {{ t.content }}
    {% if t.deadline %}
      - ç· åˆ‡: {{ t.deadline.strftime("%Y-%m-%d") }}
    {% endif %}

    <!-- âœ… ã‚¿ã‚°è¡¨ç¤º -->
    {% if t.tags %}
      <small>ï¼ˆã‚¿ã‚°: {{ t.tags | map(attribute='name') | join(', ') }}ï¼‰</small>
      <br>
  
    {% endif %}

    <!-- âœ… ç·¨é›†ãƒœã‚¿ãƒ³ -->
    {% if not t.complete %}
      <form action="/edit/{{ t.id }}" method="get" style="display:inline;">
        <button type="submit">âœç·¨é›†</button>
      </form>
    {% else %}
      <button type="button" disabled style="opacity: 0.5;">âœç·¨é›†</button>
    {% endif %}

    <!-- ğŸ—‘å‰Šé™¤ãƒœã‚¿ãƒ³ -->
    <form action="/delete/{{ t.id }}" method="post" style="display:inline;">
      <button type="submit">ğŸ—‘å‰Šé™¤</button>
    </form>
  </li>
{% else %}
  <li>ç™»éŒ²ã•ã‚ŒãŸToDoã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
{% endfor %}
</ul>

{% endblock %}
